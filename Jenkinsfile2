pipeline {
  agent any
  tools {
    nodejs "node"
  }

  stages {
    stage ('Install packages') {
      steps {
        sh "npm install"
      }
    }
    stage ('Running tests') {
      steps {
        sh "npm test"
      }
    }
    stage ("teste finalizado" ){
      steps {
        echo "Teste finalizado"
      }
    }
    stage ('Initialize Docker') {
      steps {
        script {
          def dockerHome = tool 'myDocker'
          env.PATH = "${dockerHome}/bin:${env.PATH}"
          sh "sudo usermod -a -G docker jenkins"
        }
      }
    }
    stage ('Build') {
      agent any
      steps {
        sh 'docker build -t my-nest-app .'
      }
    }
  }

}